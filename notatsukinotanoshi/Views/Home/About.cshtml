@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

<header id="mainHeader" class="jumbotron">
    <div class="container text-right">
        <h2>@ViewData["Title"]</h2>
    </div>
</header>
<div class="container body-content">
    <div class="letter markdown-body" id="manifest">
        <pre>  
@Html.Raw(@ViewData["Message"])
        </pre>
    </div>
    <div class="text-center">
        <h1>@Localizer["You can save Japari Park!"]</h1>
        <div>
            <a class="btn btn-primary" href="https://discord.gg/bbBbsGc">@Localizer["Join our discord group!"]</a>
            <a class="btn btn-success" href="/Home/Index">@Localizer["Participate in our action!"]</a>
        </div>
    </div>
    <div class="bs-callout">
        <h4>@Localizer["Talking about us"]</h4>
        <div id="tweets"></div>
    </div>
</div>

@section Scripts{ 
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script>
        const callout = '<div class="bs-callout bs-callout-warning tweets-content"><img style="float: left; margin:8px" src="[profile-pic]"><b>[tweet-name]</b> - [tweet-time]<p>[replace-text]</p></div>';
        var socket = io.connect('http://localhost:3000');
        socket.on('tweet', function (data) {
            let user = data.user;
            let tweets = $("#tweets");
            tweets.prepend(
                callout.replace('[replace-text]', data.text)
                    .replace('[tweet-name]', user.name)
                    .replace('[tweet-time]', DateFormat.format.prettyDate(data.created_at))
                    .replace('[profile-pic]', user.profile_image_url_https)
            );
            console.log($("#tweets > .tweets-content").length);
            let content = $("#tweets > .tweets-content");
            if (content.length > 5) {
                content.last().remove();
            }
        });
    </script>
}